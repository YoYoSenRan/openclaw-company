# 01. 产品设计（模拟经营 + 指挥中心）

## Scope
定义双模式产品体验：
- 经营模式：持续观察与资源管理。
- 指挥模式：实时介入与任务调度。

## Non-goals
- 不做复杂战斗系统。
- 不做开放世界探索。
- 不做剧情驱动 RPG 任务线。

## Out-of-scope
- 玩家社交系统、排行榜。
- 付费道具与经济系统。

## 双模式体验设计

### 1) 经营模式（Management Loop）
目标：让公司“自己运转”并持续反馈风险与效率。

核心行为：
1. 观察员工活动（移动、协作、休息、开会、处理中断）。
2. 调整资源（工位布局、会议室占用、加班策略、优先级策略）。
3. 处理事件（需求变更、故障报警、关键人缺席）。

反馈维度：
- 产能（吞吐量）
- 质量（返工率）
- 稳定性（故障率）
- 情绪与健康（压力、疲劳）

### 2) 指挥模式（Command Loop）
目标：关键时刻快速决策与执行。

核心行为：
1. 点名某个员工分配任务。
2. 批量选择员工执行统一策略。
3. 强制中断、重试、交接、优先级抢占。
4. 进入战情视图查看阻塞链路与热点。

反馈维度：
- 命令下发时延
- 状态切换成功率
- 任务完成率

## 关键互动演出（你指定的“PM派单”）

### 电话派单
1. PM 在工位触发电话动画。
2. 目标员工头顶弹出“来电”图标。
3. 状态流转：`Idle -> Briefing -> Executing`。
4. 若员工忙碌：触发“抢占确认弹窗”，确认后执行 `agent.pause + agent.assign`。

### 面交派单
1. PM 角色自动寻路到员工工位。
2. 触发 2~3 秒对话泡泡动画（含任务标题）。
3. 任务卡片飞入员工头顶并加入其任务队列。
4. 员工执行准备动作后进入 `Executing` 状态。

### 会议派单（多人）
1. PM 召集相关员工前往会议室。
2. 显示任务拆分板（子任务与依赖箭头）。
3. 会议结束后各员工获得子任务图标与时间预算。

#### 会议派单状态流（v1）
- `Idle -> Briefing(meeting) -> Thinking -> Executing`
- 若会议中出现冲突需求：`Briefing -> Blocked(require_clarification)`。

#### 子任务拆分规则（v1）
1. 默认由 PM 手动确认子任务拆分。
2. 系统可给出自动拆分建议，但必须人工确认后生效。
3. 子任务依赖关系必须形成有向无环图（DAG）。

## 员工头顶信息层（HUD）
1. 任务类型图标：开发/测试/设计/运营/客服。
2. 状态环：`Idle/Thinking/Executing/Blocked/Reviewing/Error`。
3. 进度条：任务完成百分比。
4. 时间提示：ETA 与超时预警。
5. 告警徽标：需求不清、依赖阻塞、资源不足。

## 任务系统设计

### 任务基本属性
- `taskId`
- `title`
- `type`
- `priority`
- `estimateMinutes`
- `dependencies`
- `riskLevel`
- `acceptanceChecklist`

### 执行策略
1. FIFO（默认）
2. Priority First（紧急优先）
3. WIP 限制（防止同时处理过多任务）
4. 自动拆分（复杂任务拆为可并行子任务）

### 批量操作边界
1. 单次批量操作目标上限：`<=20` 人。
2. 若部分失败，返回“成功列表 + 失败列表 + 可重试建议”。
3. 批量操作必须支持一键回滚到操作前快照（限 30 秒内）。

### 任务取消规则
1. 仅 PM/Operator 可触发取消。
2. 任务进入 `Cancelled` 后默认不可恢复，需新建任务重开。
3. 若任务已产生子任务，取消主任务需联动取消未开始的子任务。

## 经营变量（模拟感核心）
1. `energy`（精力）：影响速度。
2. `focus`（专注）：影响错误率。
3. `stress`（压力）：影响稳定性与中断概率。
4. `skill`（技能）：影响处理复杂任务能力。

变量影响规则示例：
- `energy < 30`：执行效率 -25%。
- `stress > 80`：错误概率 +30%。
- `skill >= taskDifficulty`：返工率显著下降。

## 战情视图（Command Overlay）
1. 任务依赖图层：显示当前关键路径。
2. 热力图层：显示高负载区域。
3. 阻塞链路：从失败节点反推上游依赖。
4. 风险时间轴：显示即将超时的任务队列。

## 故障与事件设计
1. 紧急插单：打断当前流程并重排优先级。
2. API 故障：触发多人协作修复。
3. 需求反复变更：提高返工率并降低士气。
4. 关键员工缺席：触发交接与人力重排。

## 新手引导路径（5分钟）
1. 认识状态图标和员工信息。
2. 完成一次电话派单。
3. 处理一次阻塞告警。
4. 在战情视图完成一次重试/交接。
5. 查看任务完成与复盘摘要。

### 引导实现建议
- 采用“遮罩高亮 + 步进提示 + 手把手任务”三段式引导。
- 引导状态持久化到本地存储，允许用户跳过与重置。

## 验收清单
- 可演示电话派单、面交派单、会议派单三种路径。
- 每个状态变更都能在画面中可视化体现。
- 指挥操作有明确成功/失败反馈。
- 经营变量能真实影响执行结果。
